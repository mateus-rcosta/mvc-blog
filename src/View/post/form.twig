{% extends "layout.twig" %}

{% block content %}
    <h1>{% if post.id %}Editar Post{% else %}Criar Novo Post{% endif %}</h1>

    <form action="/post/create" method="POST">
        {% if post.id %}
            <input type="hidden" name="id" value="{{ post.id }}">
        {% endif %}

        <div class="form-group">
            <label for="titulo">Título:</label>
            <input type="text" id="titulo" name="titulo" required
                   class="form-control"
                   value="{{ post.titulo | default('') }}">
        </div>

        <div class="form-group">
            <label for="conteudo">Conteúdo:</label>
            <textarea id="conteudo" name="conteudo" required class="form-control" rows="5">{{ post.conteudo | default('') }}</textarea>
        </div>

        <div class="form-group">
            <label for="tags">Tags:</label>
            {% set postTagIds = [] %}
            {% if post.tags is defined %}
                {% for t in post.tags %}
                    {% set _ = postTagIds.append(t.id) %}
                {% endfor %}
            {% endif %}
            <select id="tags" name="tags" class="form-control" multiple>
                {% for tag in tags %}
                    <option value="{{ tag.id }}"
                        {% if tag.id in postTagIds %}selected{% endif %}>
                        {{ tag.nome }}
                    </option>
                {% endfor %}
            </select>
        </div>
            
        <div class="form-group">
            <label for="userId">Usuário:</label>
            <select id="userId" name="userId" required class="form-control">
                <option value="">Selecione um usuário</option>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if post.userId == user.id %}selected{% endif %}>{{ user.nome }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="authorId">Autor:</label>
            <select id="authorId" name="authorId" class="form-control">
                <option value="">Selecione um autor</option>
                {% for author in authors %}
                    <option value="{{ author.id }}" {% if post.authorId == author.id %}selected{% endif %}>{{ author.nome }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="categoryId">Categoria:</label>
            <select id="categoryId" name="categoryId" class="form-control">
                <option value="">Selecione uma categoria</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" {% if post.categoryId == category.id %}selected{% endif %}>{{ category.nome }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" name="published" {% if post.published %}checked{% endif %}>
                Publicar post
            </label>
        </div>

        {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <button type="submit" class="btn btn-primary">Salvar Post</button>
        <a href="/post" class="btn btn-secondary">Cancelar</a>
    </form>
{% endblock %}
